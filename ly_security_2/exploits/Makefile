# exploits/Makefile

ENTRYPOINT	= 0x1000
ASM		= nasm
CC		= gcc
LD		= ld
ASMFLAGS	= -I ../include/ -f elf
CFLAGS		= -I ../include/ -c -fno-builtin -fno-stack-protector -Wall
LDFLAGS		= -Ttext $(ENTRYPOINT)
LIB		= ../lib/orangescrt.a

START_OBJ   = start.o

BINS		= leak crash overflow

.PHONY : everything clean all

everything : $(BINS)

clean :
	rm -f *.o $(BINS)

all : clean everything

start.o : ../command/start.asm
	$(ASM) $(ASMFLAGS) -o $@ $<

leak.o : leak.c
	$(CC) $(CFLAGS) -o $@ $<

leak : leak.o start.o $(LIB)
	$(LD) $(LDFLAGS) -o $@ leak.o start.o $(LIB)

crash.o : crash.c
	$(CC) $(CFLAGS) -o $@ $<

crash : crash.o start.o $(LIB)
	$(LD) $(LDFLAGS) -o $@ crash.o start.o $(LIB)

overflow.o : overflow.c
	$(CC) $(CFLAGS) -o $@ $<

overflow : overflow.o start.o $(LIB)
	$(LD) $(LDFLAGS) -o $@ overflow.o start.o $(LIB)
